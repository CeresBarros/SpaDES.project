---
title: "Finding other modules"
author: "Eliot McIntire"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Finding other modules}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options:
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE
)

SuggestedPkgsNeeded <- c("SpaDES.core", "igraph", "visNetwork", "ellipsis", "terra")
hasSuggests <- all(sapply(SuggestedPkgsNeeded, require, character.only = TRUE, quietly = TRUE))
useSuggests <- !(tolower(Sys.getenv("_R_CHECK_DEPENDS_ONLY_")) == "true")

knitr::opts_chunk$set(eval = hasSuggests && useSuggests &&
                        Sys.info()["user"] == "emcintir")# && interactive())
options(Ncpus = 1)

knitr::opts_chunk$set(fig.width=9, fig.height=7) # sets html figure height and width

# options(Require.clonePkgs = TRUE)

```

```{r setCRAN,echo=FALSE}
## cleanup / restore state
if (is.null(getOption("repos")) || !"CRAN" %in% names(getOption("repos"))) {
  options(repos = c(CRAN = "https://cloud.r-project.org"))
}
```

```{r install-spades-project}
if (!require("SpaDES.project")) {
  {install.packages("SpaDES.project", repos = "predictiveecology.r-universe.dev")
   require("SpaDES.project")}
}
```



## Find other's modules

One powerful aspect of `SpaDES` is the ability to connect to other people's modules. It can be challenging to know where other modules are and what they do. Using the `listModules` function.

### A small selection of SpaDES modules

#### **Some Biomass_* modules**
This will search the `PredictiveEcology` github.com repository for any SpaDES module whose name has `Biomass_species`, `Biomass_core`, `Biomass_regen` in it. The search will find any module that contains those keywords, i.e., `Biomass_regen` will find `Biomass_regeneration`

```{r clean13,echo=FALSE}
## cleanup / restore state
# SpaDES.project::.teardownProject(out$paths, origLibPaths)
knitr::opts_knit$set(root.dir = Require::checkPath(file.path(tempdir(), "listModules"), create = TRUE ))
```

```{r listModulesSmall,result='hide',message=FALSE}
Account <- "PredictiveEcology"
grepListShort <- "Biomass_species|Biomass_core|Biomass_regen"
mods <- listModules(grepListShort, accounts = Account)

modPath <- normPath(".")
out <- Map(mod = mods, nam = names(mods), function(mod, nam) {
  out <- getModule(paste0(nam, "/", mod),
  modulePath = modPath)
  out
})

if (requireNamespace("igraph", quietly = TRUE) &&
    requireNamespace("visNetwork", quietly = TRUE) &&
    requireNamespace("SpaDES.core", quietly = TRUE) &&
    requireNamespace("raster", quietly = TRUE)) {

  DT <- moduleDependencies(mods, modulePath = modPath)
  graph <- moduleDependenciesToGraph(DT)
  (vn <- PlotModuleGraph(graph))
}
```

#### **FireSense modules**

```{r FireSense,result='hide',message=FALSE}
Account <- "PredictiveEcology"
grepListShort <- "fireSense"
mods <- listModules(grepListShort, accounts = Account)

modPath <- normPath(".")
out <- Map(mod = mods, nam = names(mods), function(mod, nam) {
  out <- getModule(paste0(nam, "/", mod),
  modulePath = modPath)
  out
})

if (requireNamespace("igraph", quietly = TRUE) &&
    requireNamespace("visNetwork", quietly = TRUE) &&
    requireNamespace("SpaDES.core", quietly = TRUE) &&
    requireNamespace("raster", quietly = TRUE)) {

  DT <- moduleDependencies(mods, modulePath = modPath)
  graph <- moduleDependenciesToGraph(DT)
  (vn <- PlotModuleGraph(graph))
}
```


#### **LandR modules**

```{r LandR,result='hide',message=FALSE}
Account <- "PredictiveEcology"
grepListShort <- "Biomass_|LandR"
mods <- listModules(grepListShort, accounts = Account)

modPath <- normPath(".")
out <- Map(mod = mods, nam = names(mods), function(mod, nam) {
  out <- getModule(paste0(nam, "/", mod),
  modulePath = modPath)
  out
})

if (requireNamespace("igraph", quietly = TRUE) &&
    requireNamespace("visNetwork", quietly = TRUE) &&
    requireNamespace("SpaDES.core", quietly = TRUE) &&
    requireNamespace("raster", quietly = TRUE)) {

  DT <- moduleDependencies(mods, modulePath = modPath)
  graph <- moduleDependenciesToGraph(DT)
  (vn <- PlotModuleGraph(graph))
}
```



### A larger selection of "known" SpaDES modules

```{r listModulesAll,result='hide',message=FALSE,error=FALSE,warning=FALSE}
# Can do same, but with long list -- not done here -- can try
accountsListLong <- c("PredictiveEcology", "ianmseddy", "achubaty",
                       "FOR-CAST", "eliotmcintire", "tati-micheletti", "CeresBarros")
grepListLong <- c("Biomass", "WBI", "LandR", "fireSense", "CBM",
                  "LandMine", "LandWeb", "NRV", #"scfm",
                  "priority", "fire",
                  "dataPrep", "DataPrep", "RoF", "Ontario", "ROF")
modsLong <- listModules(grepListLong, accounts = accountsListLong)
# pass to listModules for much larger figure
modPath <- normPath(".")
out <- Map(mod = modsLong, nam = names(modsLong), function(mod, nam) {
  out <- getModule(paste0(nam, "/", mod),
                   modulePath = modPath)
  out
})

if (requireNamespace("igraph", quietly = TRUE) &&
    requireNamespace("visNetwork", quietly = TRUE) &&
    requireNamespace("SpaDES.core", quietly = TRUE) &&
    requireNamespace("raster", quietly = TRUE) ) {

  DT <- moduleDependencies(modsLong, modulePath = modPath)
  graph <- moduleDependenciesToGraph(DT)
  (vn <- PlotModuleGraph(graph))
}


```
